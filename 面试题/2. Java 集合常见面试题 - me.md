# Java集合面试题

## 1. Java中的集合？

>Conllection：List、Set、Queue
>Map：

## 2. ArrayList 和 LinkedList?

>1、内部结构 2、随机访问性能 3、插入和删除 4、内存占用 5、性能原因 6、线程安全 7、使用场景

**因此，在多查的场景下考虑使用 ArrayList，而在插入和删除比较多的场景下考虑使用 LinkedList。**

## 3. ArrayList线程安全问题？

>1、加锁 2、CopyOnWriteArrayList

## 4. HashMap底层？

>底层：数组+链表+红黑树。
>
>是什么：key-value的存储结构。curd的时间复杂度 O(1)

## 5. 为什么HashMap要使用红黑树？而不使用别的树？

> - 普通的二叉搜索树：可能会出现O(n)
> - AVL树：增删效率低

## 6. 哈希冲突?

> 链地址、再哈希、开放

## 7. 负载因子是0.75?

> 性能-空间利用率

## 8. HashMap的新增流程？

> 计算哈希值、处理哈希冲突、检查是否扩容、检查是否链表改红黑树、是否存在key相同的情况，更新value值，没有插入、**更新元素总数量**

## 9. HashMap的查询流程？

> 计算哈希值、确定数组索引、处理哈希冲突、比较键、返回值

## 10. HashMap 和 Hashtable 有什么区别?

> 线程安全性、性能、null键的支持

## 11. 为什么Hashtable不允许插入null键和null值? 

> 空指针异常、键的唯一性

## 12. HashMap是线程安全的吗?为什么?

>扩容时：环形链表问题  修改时：数据覆盖问题

##  13. HashMap扩容的时候为什么会死循环问题?

> 头插法

## 14. HashMap为什么会数据覆盖?

插入数据时候没有上锁

## 15. 如何保证HashMap线程安全?

1. 上锁
2. 使用现场安全的容器

## 16. Hashtable是如何保证线程安全的?

全局锁

## 17. ConcurrentHashMap为什么是线程安全的? 

> - 分段锁（Segment Lock）
> - CAS和volatile
> - 读写分离

## 18. 什么是分段锁？ 实现一个分段锁？

> 它将数据结构（如哈希表）分成多个独立的部分（段），每个段都有自己的锁。
>
> 1. **分段锁求索引，注意hashcode值出现负数**
> 2. **分段锁解锁加到finally**
>
> ```java
> import java.util.ArrayList;
> import java.util.HashMap;
> import java.util.List;
> import java.util.concurrent.locks.Lock;
> import java.util.concurrent.locks.ReentrantLock;
> 
> class SegmentedHashMap<K, V> {
>     private final int segmentCount;
>     private final List<Segment<K, V>> segments;
> 
>     // 定义每个段的内部结构
>     private static class Segment<K, V> {
>         private final HashMap<K, V> map;
>         private final Lock lock;
> 
>         public Segment() {
>             this.map = new HashMap<>();
>             this.lock = new ReentrantLock();
>         }
>     }
> 
>     public SegmentedHashMap(int segmentCount) {
>         this.segmentCount = segmentCount;
>         segments = new ArrayList<>(segmentCount);
>         for (int i = 0; i < segmentCount; i++) {
>             segments.add(new Segment<>());
>         }
>     }
> 
>     // 根据键的哈希值确定段的索引
>     private int segmentIndex(K key) {
>         int hash = key.hashCode();
>         return Math.abs(hash % segmentCount);
>     }
> 
>     public V put(K key, V value) {
>         Segment<K, V> segment = segments.get(segmentIndex(key));
>         segment.lock.lock();
>         try {
>             return segment.map.put(key, value);
>         } finally {
>             segment.lock.unlock();
>         }
>     }
> 
>     public V get(K key) {
>         Segment<K, V> segment = segments.get(segmentIndex(key));
>         segment.lock.lock();
>         try {
>             return segment.map.get(key);
>         } finally {
>             segment.lock.unlock();
>         }
>     }
> }
> 
> public class Main {
>     public static void main(String[] args) {
>         SegmentedHashMap<Integer, String> map = new SegmentedHashMap<>(4);
>         // 线程1插入数据
>         new Thread(() -> {
>             for (int i = 0; i < 1000; i++) {
>                 map.put(i, "Value " + i);
>             }
>         }).start();
>         // 线程2插入数据
>         new Thread(() -> {
>             for (int i = 1000; i < 2000; i++) {
>                 map.put(i, "Value " + i);
>             }
>         }).start();
>     }
> }
> ```

## 19. 说一下ConcurrentHashMap的锁优化?

> 分段锁-数组+链表/红黑树-CAS和volatile

## 20. ConcurrentHashMap为什么不能插入null?

> 1. 避免空指针异常
> 2. 防止产生歧义

## 21. 链表的分类有哪些？

> 单链表-双向链表-循环链表-双向循环链表

## 22. 树的分类有哪些？

> 二叉树——二叉搜索树——AVL树——红黑树——B树——B+树——trie树

## 23. ArrayList 和 Vector 有什么区别?

> 1. 安全方面
> 2. 扩容方面

## 24. ArrayList是如何进行扩容的?

> 创建新数组，然后依次便利

## 25. Collection 和 Collections 有什么区别?

> Collection：它是一个接口，是 Java 集合框架中的最基本的接口之一。定义了操作元素的抽象方法。并且有许多实现类。
>
> **Collections**：这是一个工具类，提供了一系列静态方法来操作集合。排序-移动-二分查找-填充-复制-求最大最小值

## 26. CopyOnWriteArrayList是线程安全的吗?

> 写时复制技术-适合读多写少场景-可能会导致内存开销问题。

## 27. 什么是写时复制技术？

> 定义：多个使用者使用资源时，只有对资源进行修改的使用者才会真正地复制一份副本用于修改。
>
> 优点：高效、简单并发。
>
> 缺点：内存开销、数据延迟更新。

## 28. HashMap设置初始容量为17，那么它的实际容量是多少?

> 默认初始是16
>
> 2的n次方
> 所以是32

## 29. 开放地址法如何找下一个空地址?

> 线性探测、二次探测、双重哈希

## 30. 集合和数组的区别和联系？

> 1、长度方面 2、数据类型存储 3、功能方法 4、内存占用形式

## 31. 为什么签到用bitmap?bitmap有什么好处?

> bitmap -> 位数组优势!
>
> 1. 节约内存空间
>
> 2. 查询快 -> O(1)